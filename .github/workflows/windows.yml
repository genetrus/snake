name: Windows

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Check vcpkg availability
        id: vcpkg_check
        shell: bash
        run: |
          if [ -f external/vcpkg/bootstrap-vcpkg.bat ]; then
            echo "available=true" >> "$GITHUB_OUTPUT"
          else
            echo "available=false" >> "$GITHUB_OUTPUT"
          fi

      - name: Bootstrap vcpkg
        if: steps.vcpkg_check.outputs.available == 'true'
        shell: pwsh
        run: external/vcpkg/bootstrap-vcpkg.bat -disableMetrics

      - name: Configure CMake
        if: steps.vcpkg_check.outputs.available == 'true'
        shell: pwsh
        run: >
          cmake -S . -B build
          -G "Visual Studio 17 2022"
          -A x64
          -DCMAKE_TOOLCHAIN_FILE=${{ github.workspace }}\\external\\vcpkg\\scripts\\buildsystems\\vcpkg.cmake
          -DCMAKE_BUILD_TYPE=Release

      - name: Build
        if: steps.vcpkg_check.outputs.available == 'true'
        shell: pwsh
        run: cmake --build build --config Release --parallel

      - name: Placeholder when vcpkg is missing
        if: steps.vcpkg_check.outputs.available != 'true'
        shell: bash
        run: echo "vcpkg submodule not present; skipping configure/build for now."
